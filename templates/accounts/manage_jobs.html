{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">

  <!-- PAGE HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold">Manage Jobs</h2>
      <p class="text-muted mb-0">All jobs posted by your company</p>
    </div>

    <a href="{% url 'jobs:post-job' %}" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> Post New Job
    </a>
  </div>

  <!-- JOB TABLE -->
  <div class="card shadow-sm border-0">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Job Title</th>
            <th>Location</th>
            <th>Salary</th>
            <th>Status</th>
            <th>Applicants</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for job in jobs %}
          <tr>
            <td>
              <strong>{{ job.job_title }}</strong><br>
              <small class="text-muted">{{ job.job_type }}</small>
            </td>

            <td>{{ job.location }}</td>

            <td>
              {% if job.salary %}
                {{ job.salary }}
              {% else %}
                <span class="text-muted">Not specified</span>
              {% endif %}
            </td>

            <td>
              {% if job.is_active %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-secondary">Closed</span>
              {% endif %}
            </td>

            <td>
              <span class="badge bg-info">
                {{ job.applications.count }}
              </span>
            </td>

            <td class="text-end">

              <!-- VIEW -->
              <a href="{% url 'jobs:job_detail' job.id %}"
                 class="btn btn-sm btn-outline-primary">
                View
              </a>

              <!-- EDIT -->
              <a href="{% url 'jobs:edit-job' job.id %}"
                 class="btn btn-sm btn-outline-warning">
                Edit
              </a>

              <!-- DELETE -->
              <button class="btn btn-sm btn-outline-danger"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteModal{{ job.id }}">
                Delete
              </button>

              <!-- DELETE MODAL -->
              <div class="modal fade" id="deleteModal{{ job.id }}" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                  <form method="POST"
                        action="{% url 'jobs:delete-job' job.id %}"
                        class="modal-content">
                    {% csrf_token %}
                    <div class="modal-header">
                      <h5 class="modal-title">Delete Job</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                      Are you sure you want to delete
                      <strong>{{ job.job_title }}</strong>?
                      <p class="text-danger mt-2 mb-0">
                        This will also remove all applications.
                      </p>
                    </div>

                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary"
                              data-bs-dismiss="modal">Cancel</button>
                      <button type="submit" class="btn btn-danger">
                        Delete
                      </button>
                    </div>
                  </form>
                </div>
              </div>

            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">
              No jobs posted yet.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

</div>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}
