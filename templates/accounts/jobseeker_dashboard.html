{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container py-5">

  <!-- ================= PAGE TITLE ================= -->
  <div class="text-center mb-5">
    <h2 class="fw-bold">Jobseeker Dashboard</h2>
    <p class="text-muted">Track all your job applications in one place</p>
  </div>

  <!-- ================= SUMMARY CARDS ================= -->
  <div class="row g-4 mb-5">

    <div class="col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body">
          <h6 class="text-muted">Total Applied</h6>
          <h3 class="fw-bold text-primary">{{ applied_jobs|length }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body">
          <h6 class="text-muted">Pending</h6>
          <h3 class="fw-bold text-warning">
            {{ applied_jobs|dictsort:"status"|length }}
          </h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body">
          <h6 class="text-muted">Accepted</h6>
          <h3 class="fw-bold text-success">
            {{ accepted_count|default:"0" }}
          </h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body">
          <h6 class="text-muted">Rejected</h6>
          <h3 class="fw-bold text-danger">
            {{ rejected_count|default:"0" }}
          </h3>
        </div>
      </div>
    </div>

  </div>

  <!-- ================= APPLIED JOBS TABLE ================= -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-white border-0">
      <h5 class="fw-bold mb-0">
        <i class="bi bi-briefcase-fill text-primary"></i>
        My Applied Jobs
      </h5>
    </div>

    <div class="card-body">

      {% if applied_jobs %}

      <div class="table-responsive">
        <table class="table align-middle table-hover">
          <thead class="table-light">
            <tr>
              <th>S.N.</th>
              <th>Job Title</th>
              <th>Company</th>
              <th>Location</th>
              <th>Salary</th>
              <th>Applied Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>

            {% for application in applied_jobs %}
            <tr>
              <td>{{ forloop.counter }}</td>

              <td class="fw-semibold">
                {{ application.job.job_title }}
              </td>

              <td>{{ application.job.company.company_name }}</td>

              <td>
                <i class="bi bi-geo-alt"></i>
                {{ application.job.location }}
              </td>

              <td>
                {% if application.job.salary %}
                  {{ application.job.salary }}
                {% else %}
                  <span class="text-muted">Not disclosed</span>
                {% endif %}
              </td>

              <td>
                {{ application.applied_at|date:"d M Y" }}
              </td>

              <td>
                {% if application.status == "pending" %}
                  <span class="badge bg-warning text-dark">
                    {{ application.get_status_display }}
                  </span>
                {% elif application.status == "accepted" %}
                  <span class="badge bg-success">
                    {{ application.get_status_display }}
                  </span>
                {% elif application.status == "rejected" %}
                  <span class="badge bg-danger">
                    {{ application.get_status_display }}
                  </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}

          </tbody>
        </table>
      </div>

      {% else %}
        <div class="text-center py-5">
          <img src="{% static 'images/no-data.svg' %}" width="180" class="mb-3">
          <p class="text-muted">
            You havenâ€™t applied to any jobs yet.
          </p>
          <a href="{% url 'jobs:job-list' %}" class="btn btn-primary">
            Browse Jobs
          </a>
        </div>
      {% endif %}

    </div>
  </div>

</div>

<!-- ================= STYLES ================= -->
<style>
.table-hover tbody tr:hover {
  background-color: #f9fbff;
}
.card {
  border-radius: 14px;
}
</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

{% endblock %}
