{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h3 class="mb-4">Manage Applicants</h3>

  <!-- Filters -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
      <select name="job" class="form-select">
        <option value="">All Jobs</option>
        {% for job in jobs %}
          <option value="{{ job.id }}" {% if selected_job == job.id %}selected{% endif %}>
            {{ job.job_title }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <select name="status" class="form-select">
        <option value="">All Status</option>
        <option value="pending" {% if selected_status == "pending" %}selected{% endif %}>Pending</option>
        <option value="accepted" {% if selected_status == "accepted" %}selected{% endif %}>Accepted</option>
        <option value="rejected" {% if selected_status == "rejected" %}selected{% endif %}>Rejected</option>
      </select>
    </div>

    <div class="col-md-3">
      <select name="top" class="form-select">
        <option value="">All Applicants</option>
        <option value="1" {% if selected_top %}selected{% endif %}>Top Applicants (70%+)</option>
      </select>
    </div>

    <div class="col-md-3">
      <button class="btn btn-primary w-100">Filter</button>
    </div>
  </form>

  <!-- Applicants Table -->
  <div class="card shadow">
    <div class="card-body table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Applicant</th>
            <th>Job</th>
            <th>Match</th>
            <th>Applied</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
        {% for item in applicants %}
          <tr>
            <td>
              <strong>{{ item.app.applicant.full_name }}</strong><br>
              <small>{{ item.app.applicant.email }}</small>
            </td>

            <td>{{ item.app.job.job_title }}</td>

            <td>
              <span class="badge bg-success">{{ item.match_score }}%</span>
            </td>

            <td>{{ item.app.applied_at|date:"M d, Y" }}</td>

            <td>
              <span class="badge 
                {% if item.app.status == 'accepted' %}bg-success
                {% elif item.app.status == 'rejected' %}bg-danger
                {% else %}bg-warning{% endif %}">
                {{ item.app.status|title }}
              </span>
            </td>

            <td>
              <a href="{{ item.app.cv.url }}" class="btn btn-sm btn-outline-secondary" target="_blank">
                View CV
              </a>

              {% if item.app.status == "pending" %}
                <a href="{% url 'applications:update_application_status' item.app.id 'accepted' %}" 
                   class="btn btn-sm btn-success">
                   Accept
                </a>

                <a href="{% url 'applications:update_application_status' item.app.id 'rejected' %}" 
                   class="btn btn-sm btn-danger">
                   Reject
                </a>

              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              No applicants found
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
